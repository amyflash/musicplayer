<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æ’­æ”¾ - æ­Œè¯æ˜¾ç¤º (ç½‘ç»œåˆ—è¡¨)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #000;
            color: #fff;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }
        .container {
            width: 100%;
            height: 100%;
            display: flex;
        }
        /* å·¦ä¾§ - æ’­æ”¾æ§åˆ¶å’Œåˆ—è¡¨ */
        .player-section {
            width: 50%;
            background-color: #111;
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #333;
        }
        .player-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
            color: #4CAF50;
        }
        .status-message {
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
            color: #ccc;
        }

        /* ===== æ’­æ”¾è¿›åº¦æ¡æ ·å¼ ===== */
        .progress-container {
            width: 100%;
            padding: 0 15px;
            margin-bottom: 15px;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #333;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) inset;
        }
        .progress-filled {
            width: 0;
            height: 100%;
            background-color: #4CAF50;
            border-radius: 4px;
            transition: width 0.1s ease;
        }
        .progress-time {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }
        .progress-time span {
            font-family: monospace; /* ç­‰å®½å­—ä½“æ›´æ•´é½ */
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        .audio-controls button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        .audio-controls button:hover:not(:disabled) {
            background-color: #45a049;
        }
        .audio-controls button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        .current-song {
            text-align: center;
            margin: 15px 0;
            font-size: 1.3em;
            font-weight: bold;
            color: #e0e0e0;
            min-height: 1.5em;
        }
        .song-list {
            list-style: none;
            max-height: 50vh; /* è°ƒæ•´é«˜åº¦ä¸º50vhï¼Œä¸ºè¿›åº¦æ¡å’ŒæŒ‰é’®ç•™å‡ºç©ºé—´ */
            overflow-y: auto;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
        }
        .song-list li {
            padding: 12px 15px;
            margin-bottom: 5px;
            background-color: #2d2d2d;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 1.1em;
        }
        .song-list li:hover {
            background-color: #3a3a3a;
            transform: scale(1.02);
        }
        .song-list li.active {
            background-color: #4CAF50;
            color: #fff;
            font-weight: bold;
        }
        .song-list li:active {
            transform: scale(0.98);
        }

        /* å³ä¾§ - æ­Œè¯æ˜¾ç¤º */
        .lyrics-section {
            width: 50%;
            background-color: #000;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .lyrics-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            color: #FFD700;
        }
        .lyrics-container {
            width: 100%;
            height: 70vh;
            overflow-y: auto;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #444;
        }
        .lyrics-display {
            font-size: 1.8em;
            line-height: 1.8;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            width: 100%;
            text-align: center;
        }
        /* ===== æ­Œè¯é«˜äº®æ ·å¼ ===== */
        .lyrics-display .current-line {
            color: #4CAF50; /* é«˜äº®é¢œè‰²ï¼Œä¾‹å¦‚ç»¿è‰² */
            text-shadow: 2px 2px 6px rgba(76, 175, 80, 0.5); /* é«˜äº®æ–‡å­—çš„é˜´å½± */
            font-size: 1.1em; /* å¯é€‰ï¼šè®©å½“å‰è¡Œç¨å¤§ä¸€ç‚¹ */
            font-weight: bold; /* å¯é€‰ï¼šåŠ ç²—å½“å‰è¡Œ */
            transform: scale(1.05); /* å¯é€‰ï¼šè½»å¾®æ”¾å¤§å½“å‰è¡Œ */
            transition: all 0.2s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        }
        /* å¯é€‰ï¼šè°ƒæ•´æ‰€æœ‰æ­Œè¯è¡Œçš„æ ·å¼ */
        .lyrics-display p {
            margin: 0.5em 0;
            opacity: 0.8;
            transition: all 0.2s ease;
        }
        /* éå½“å‰è¡Œçš„æ­Œè¯æ›´æš—ä¸€äº› */
        .lyrics-display p:not(.current-line) {
            color: #aaa;
        }
        .no-lyrics {
            font-size: 1.5em;
            color: #888;
            font-style: italic;
            text-align: center;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-aspect-ratio: 2/1) {
            .lyrics-display {
                font-size: 1.5em;
            }
        }
        @media (min-aspect-ratio: 3/1) {
            .lyrics-display {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§ï¼šæ’­æ”¾å™¨å’Œåˆ—è¡¨ -->
        <div class="player-section">
            <h1 class="player-header">ğŸµ éŸ³ä¹æ’­æ”¾å™¨</h1>
            
            <p class="status-message" id="statusMessage">åŠ è½½æ’­æ”¾åˆ—è¡¨...</p>

            <!-- æ’­æ”¾è¿›åº¦æ¡ -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-filled" id="progressFilled"></div>
                </div>
                <div class="progress-time">
                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                </div>
            </div>
            
            <div class="audio-controls">
                <button id="prevBtn" disabled>â® ä¸Šä¸€æ›²</button>
                <button id="playPauseBtn" disabled>â–¶ æ’­æ”¾</button>
                <button id="nextBtn" disabled>ä¸‹ä¸€æ›² â­</button>
            </div>

            <p class="current-song" id="currentSongInfo">å°±ç»ª</p>

            <h3>æ’­æ”¾åˆ—è¡¨</h3>
            <ul class="song-list" id="songList">
                <!-- æ­Œæ›²åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </div>

        <!-- å³ä¾§ï¼šæ­Œè¯æ˜¾ç¤º -->
        <div class="lyrics-section">
            <h2 class="lyrics-header">ğŸ¤ æ­Œè¯</h2>
            <div class="lyrics-container">
                <div class="lyrics-display" id="lyricsDisplay">
                    <p class="no-lyrics">ç­‰å¾…æ’­æ”¾</p>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  (éšè—) -->
    <audio id="audioPlayer" preload="metadata"></audio>

    <script>
        // ===== é…ç½®ï¼šæ’­æ”¾åˆ—è¡¨æ–‡ä»¶è·¯å¾„ =====
        const PLAYLIST_FILE = 'playlist_tv.txt'; // ç¡®ä¿æ­¤æ–‡ä»¶åœ¨åŒç›®å½•ä¸‹

        // ===== DOM å…ƒç´ å¼•ç”¨ =====
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const songListElement = document.getElementById('songList');
        const currentSongInfo = document.getElementById('currentSongInfo');
        const lyricsDisplay = document.getElementById('lyricsDisplay');
        const statusMessage = document.getElementById('statusMessage');
        const progressFilled = document.getElementById('progressFilled');
        const currentTimeElement = document.getElementById('currentTime');
        const durationElement = document.getElementById('duration');

        // ===== çŠ¶æ€å˜é‡ =====
        let songList = []; // å­˜å‚¨ä» playlist.txt åŠ è½½çš„æ­Œæ›²æ•°æ®
        let currentSongIndex = -1;
        let lyricsData = [];
        let currentLyricIndex = 0;

        // ===== åˆå§‹åŒ– =====
        async function init() {
            if (!audioPlayer.canPlayType) {
                showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 Audioã€‚');
                return;
            }

            try {
                // åŠ è½½æ’­æ”¾åˆ—è¡¨
                await loadPlaylist();
                statusMessage.textContent = `å…± ${songList.length} é¦–æ­Œæ›²`;
                
                // æ„å»ºæ’­æ”¾åˆ—è¡¨ UI
                buildSongList();

                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                bindEventListeners();
initProgressBar(); // <<< æ·»åŠ è¿™ä¸€è¡Œ
                // åˆå§‹çŠ¶æ€
                updateControlsState();

            } catch (error) {
                showError(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }


        function initProgressBar() {
    const progressBar = document.getElementById('progressBar');

    // é˜²æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
    const preventDefaults = (e) => {
        e.preventDefault();
        e.stopPropagation();
    };

    // è®¡ç®—ç‚¹å‡»/è§¦æ‘¸ä½ç½®å¯¹åº”çš„æ—¶é—´
    const calculateTime = (e) => {
        const rect = progressBar.getBoundingClientRect();
        let clientX;

        // å¦‚æœæ˜¯è§¦æ‘¸äº‹ä»¶ï¼Œè·å–è§¦æ‘¸ç‚¹ä½ç½®
        if (e.touches && e.touches[0]) {
            clientX = e.touches[0].clientX;
        } else if (e.clientX) {
            // å¦‚æœæ˜¯é¼ æ ‡äº‹ä»¶ï¼Œè·å–é¼ æ ‡ä½ç½®
            clientX = e.clientX;
        } else {
            return 0;  // å¦‚æœæ— æ³•è·å–ä½ç½®ï¼Œç›´æ¥è¿”å› 0
        }

        const pos = (clientX - rect.left) / rect.width;
        return audioPlayer.duration * pos;
    };

    // æ›´æ–°è¿›åº¦æ¡ï¼ˆä»…è§†è§‰ï¼Œä¸æ”¹å˜æ’­æ”¾æ—¶é—´ï¼‰
    const updateVisualProgress = (time) => {
        const percent = audioPlayer.duration ? (time / audioPlayer.duration) * 100 : 0;
        document.getElementById('progressFilled').style.width = `${percent}%`;
    };

    // è®¾ç½®æ’­æ”¾æ—¶é—´å¹¶å¼ºåˆ¶æ›´æ–°UI
    const setPlayTime = (time) => {
        audioPlayer.currentTime = time;
        console.log('ç‚¹å‡»/è§¦æ‘¸è®¾ç½®æ—¶é—´:', time); // è°ƒè¯•ï¼šæŸ¥çœ‹è®¾ç½®çš„æ—¶é—´
        // å¼ºåˆ¶æ›´æ–°æ—¶é—´æ˜¾ç¤ºå’Œæ­Œè¯
        updateProgress(); // æ›´æ–°è¿›åº¦æ¡å’Œæ—¶é—´æ–‡æœ¬
        updateLyrics();   // å¼ºåˆ¶æ£€æŸ¥å¹¶æ›´æ–°æ­Œè¯é«˜äº®
    };

    // ===== äº‹ä»¶å¤„ç†å‡½æ•° =====

    // é¼ æ ‡/è§¦æ‘¸ç‚¹å‡»
    const handleClickOrTouch = (e) => {
        preventDefaults(e);
        const time = calculateTime(e);
        setPlayTime(time); // è®¾ç½®å®é™…æ’­æ”¾æ—¶é—´
        updateVisualProgress(time); // è§†è§‰åé¦ˆ
    };

    // ç»‘å®šäº‹ä»¶ï¼Œç¡®ä¿é¼ æ ‡å’Œè§¦æ‘¸è®¾å¤‡éƒ½èƒ½å·¥ä½œ
    ['click', 'touchstart'].forEach(evt => {
        progressBar.addEventListener(evt, handleClickOrTouch);
    });

    // æ¸…ç†å‡½æ•° (å¯é€‰)
    return () => {
        ['click', 'touchstart'].forEach(evt => {
            progressBar.removeEventListener(evt, handleClickOrTouch);
        });
    };
}



        // ===== åŠ è½½æ’­æ”¾åˆ—è¡¨ =====
        async function loadPlaylist() {
            try {
                const response = await fetch(PLAYLIST_FILE + '?t=' + new Date().getTime()); // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const text = await response.text();
                // å°è¯•è§£æ JSON
                const parsedList = JSON.parse(text);
                
                // éªŒè¯æ•°æ®ç»“æ„
                if (!Array.isArray(parsedList)) {
                    throw new Error('æ’­æ”¾åˆ—è¡¨æ ¼å¼é”™è¯¯ï¼šæ ¹å…ƒç´ å¿…é¡»æ˜¯æ•°ç»„');
                }
                if (parsedList.length === 0) {
                    throw new Error('æ’­æ”¾åˆ—è¡¨ä¸ºç©º');
                }
                // æ£€æŸ¥å¿…è¦å­—æ®µ
                for (let i = 0; i < parsedList.length; i++) {
                    const item = parsedList[i];
                    if (!item.name || !item.mp3url) {
                        throw new Error(`æ­Œæ›² ${i+1} ç¼ºå°‘å¿…è¦çš„ 'name' æˆ– 'mp3url' å­—æ®µ`);
                    }
                    // lrcurl å¯é€‰
                }

                songList = parsedList;
            } catch (error) {
                console.error('åŠ è½½æˆ–è§£ææ’­æ”¾åˆ—è¡¨å¤±è´¥:', error);
                throw error;
            }
        }

        // ===== æ„å»ºæ’­æ”¾åˆ—è¡¨ UI =====
        function buildSongList() {
            songListElement.innerHTML = '';
            songList.forEach((song, index) => {
                const li = document.createElement('li');
                li.textContent = song.name;
                li.dataset.index = index;
                songListElement.appendChild(li);
            });
        }

        // ===== ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ =====
        function bindEventListeners() {
            // éŸ³é¢‘äº‹ä»¶
            audioPlayer.addEventListener('play', updatePlayButton);
            audioPlayer.addEventListener('pause', updatePlayButton);
            audioPlayer.addEventListener('ended', playNext);
            audioPlayer.addEventListener('timeupdate', updateLyrics);
            audioPlayer.addEventListener('timeupdate', updateProgress); // æ›´æ–°è¿›åº¦æ¡
            audioPlayer.addEventListener('error', handleAudioError);
            audioPlayer.addEventListener('loadedmetadata', () => {
                updateProgress(); // å½“å…ƒæ•°æ®ï¼ˆåŒ…æ‹¬æ—¶é•¿ï¼‰åŠ è½½å®Œæˆåï¼Œæ›´æ–°è¿›åº¦æ¡
                updateControlsState();
            });

            // æŒ‰é’®äº‹ä»¶
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', playPrev);
            nextBtn.addEventListener('click', playNext);

            // æ’­æ”¾åˆ—è¡¨ç‚¹å‡»
            songListElement.addEventListener('click', (e) => {
                if (e.target.tagName === 'LI') {
                    const index = parseInt(e.target.dataset.index);
                    playSong(index);
                }
            });
        }

        // ===== æ’­æ”¾æ§åˆ¶ =====
        function playSong(index) {
            if (index < 0 || index >= songList.length) return;

            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            const activeLi = songListElement.querySelector('.active');
            if (activeLi) activeLi.classList.remove('active');

            currentSongIndex = index;
            const song = songList[currentSongIndex];

            // æ›´æ–°éŸ³é¢‘æº
            audioPlayer.src = song.mp3url;
            currentSongInfo.textContent = `æ­£åœ¨æ’­æ”¾: ${song.name}`;

            // é«˜äº®å½“å‰æ­Œæ›²
            const currentLi = songListElement.children[index];
            if (currentLi) currentLi.classList.add('active');

            // åŠ è½½å¹¶è§£ææ­Œè¯
            loadLyricsFromURL(song.lrcurl || ''); // lrcurl å¯èƒ½ä¸ºç©º

            // åŠ è½½éŸ³é¢‘
            audioPlayer.load(); // æ˜¾å¼åŠ è½½

            // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
            currentTimeElement.textContent = '0:00';
            durationElement.textContent = '0:00';

            statusMessage.textContent = 'å°±ç»ª';
            audioPlayer.play().catch(e => console.error('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));//è‡ªåŠ¨æ’­æ”¾åˆ—è¡¨
        }

        function togglePlayPause() {
            if (currentSongIndex === -1 && songList.length > 0) {
                // æœªæ’­æ”¾ä»»ä½•æ­Œæ›²ï¼Œç‚¹å‡»æ’­æ”¾é»˜è®¤ç¬¬ä¸€é¦–
                playSong(0);
                return;
            }

            if (audioPlayer.paused) {
                audioPlayer.play().catch(e => {
                    console.error('æ’­æ”¾å¤±è´¥:', e);
                    statusMessage.textContent = 'æ’­æ”¾è¢«é˜»æ­¢ï¼ˆæµè§ˆå™¨ç­–ç•¥ï¼Ÿï¼‰';
                });
            } else {
                audioPlayer.pause();
            }
        }

        function playPrev() {
            if (songList.length === 0) return;
            let prevIndex = currentSongIndex - 1;
            if (prevIndex < 0) prevIndex = songList.length - 1;
            playSong(prevIndex);
            if (!audioPlayer.paused) {
                audioPlayer.play().catch(e => console.error('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));
            }
        }

        function playNext() {
            if (songList.length === 0) return;
            let nextIndex = currentSongIndex + 1;
            if (nextIndex >= songList.length) nextIndex = 0;
            playSong(nextIndex);
            if (!audioPlayer.paused) {
                audioPlayer.play().catch(e => console.error('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e));
            }
        }

        function updatePlayButton() {
            playPauseBtn.textContent = audioPlayer.paused ? 'â–¶ æ’­æ”¾' : 'â¸ æš‚åœ';
        }

        function updateControlsState() {
            const hasSongs = songList.length > 0;
            const isPlaying = !audioPlayer.paused;
            playPauseBtn.disabled = !hasSongs;
            prevBtn.disabled = !hasSongs;
            nextBtn.disabled = !hasSongs;
            // playPauseBtn æ–‡æœ¬ç”±äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
        }

        function handleAudioError() {
            console.error('éŸ³é¢‘é”™è¯¯:', audioPlayer.error);
            statusMessage.textContent = `éŸ³é¢‘é”™è¯¯: ${audioPlayer.error.code}`;
            // å°è¯•ä¸‹ä¸€é¦–
            setTimeout(playNext, 2000);
        }

        // ===== æ ¼å¼åŒ–æ—¶é—´ (ç§’ -> MM:SS) =====
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) seconds = 0;
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ===== æ›´æ–°æ’­æ”¾è¿›åº¦æ¡ =====
        function updateProgress() {
            const currentTime = audioPlayer.currentTime;
            const duration = audioPlayer.duration || 0;

            // æ›´æ–°è¿›åº¦æ¡å®½åº¦
            const progressPercent = duration ? (currentTime / duration) * 100 : 0;
            progressFilled.style.width = `${progressPercent}%`;

            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            currentTimeElement.textContent = formatTime(currentTime);
            durationElement.textContent = formatTime(duration);
        }

        // ===== æ­Œè¯å¤„ç† (ä» URL åŠ è½½) =====
        async function loadLyricsFromURL(lrcUrl) {
            lyricsData = [];
            currentLyricIndex = 0;
            lyricsDisplay.innerHTML = '<p class="no-lyrics">åŠ è½½ä¸­...</p>';

            if (!lrcUrl) {
                lyricsDisplay.innerHTML = '<p class="no-lyrics">æ— æ­Œè¯ä¿¡æ¯</p>';
                return;
            }

            try {
                const response = await fetch(lrcUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const text = await response.text();
                lyricsData = parseLRC(text);
                
                if (lyricsData.length > 0) {
                    displayCurrentLyric(); // åŠ è½½å®Œæˆåç«‹å³æ˜¾ç¤ºæ‰€æœ‰æ­Œè¯
                } else {
                    lyricsDisplay.innerHTML = '<p class="no-lyrics">æ­Œè¯ä¸ºç©º</p>';
                }
            } catch (error) {
                console.warn('åŠ è½½æ­Œè¯å¤±è´¥:', error.message);
                lyricsDisplay.innerHTML = '<p class="no-lyrics">æ­Œè¯åŠ è½½å¤±è´¥</p>';
            }
        }

        // ===== LRC è§£æå™¨ =====
// ç¤ºä¾‹ï¼šæ­£ç¡®çš„ parseLRC
function parseLRC(lrcText) {
    const lines = lrcText.split('\n');
    const result = [];
    const timeRegex = /\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\]/;

    lines.forEach(line => {
        const match = line.match(timeRegex);
        if (match) {
            const minutes = parseInt(match[1], 10);
            const seconds = parseInt(match[2], 10);
            // å¤„ç†æ¯«ç§’/ç™¾åˆ†ç§’
            const hundredths = match[3] ? parseInt(match[3].padEnd(3, '0'), 10) / 1000 : 0; // å…¼å®¹ xx æˆ– xxx
            const totalTime = minutes * 60 + seconds + hundredths; // totalTime æ˜¯æ•°å­—

            const text = line.replace(timeRegex, '').trim();
            result.push({ 
                time: totalTime, // âœ… ç¡®ä¿è¿™æ˜¯æ•°å­—
                text: text 
            });
        }
    });

    result.sort((a, b) => a.time - b.time);
    return result;
}

 
function updateLyrics() {
    if (lyricsData.length === 0 || currentSongIndex === -1) {
        lyricsDisplay.innerHTML = '<p class="no-lyrics">ç­‰å¾…æ’­æ”¾</p>';
        return;
    }

    const currentTime = audioPlayer.currentTime;
    console.log('--- updateLyrics å¼€å§‹ ---');
    console.log('å½“å‰æ’­æ”¾æ—¶é—´ (currentTime):', currentTime, typeof currentTime);

    // å¼ºåˆ¶è½¬æ¢ currentTime ä¸ºæ•°å­—
    const safeCurrentTime = parseFloat(currentTime) || 0;
    console.log('å®‰å…¨çš„å½“å‰æ—¶é—´:', safeCurrentTime);

    // æ£€æŸ¥ lyricsData çš„ç»“æ„å’Œç±»å‹
    console.log('lyricsData é•¿åº¦:', lyricsData.length);
    lyricsData.forEach((item, idx) => {
        console.log(`ç¬¬${idx}è¡Œ - time: "${item.time}" (ç±»å‹: ${typeof item.time}), text: "${item.text}"`);
        // å¼ºåˆ¶è½¬æ¢ time ä¸ºæ•°å­—
        item.time = parseFloat(item.time);
        if (isNaN(item.time)) {
            console.warn(`æ­Œè¯ç¬¬${idx}è¡Œçš„æ—¶é—´æ— æ•ˆï¼Œå·²è®¾ä¸º0`, item);
            item.time = 0;
        }
        console.log(`  -> è½¬æ¢å time: ${item.time} (ç±»å‹: ${typeof item.time})`);
    });

    let newLyricIndex = 0;

    // ä»åå¾€å‰æ‰¾ï¼Œæ‰¾åˆ°æœ€åä¸€æ¡ time <= safeCurrentTime çš„æ­Œè¯
    for (let i = 0; i < lyricsData.length; i++) {
        console.log(`æ¯”è¾ƒ: ${safeCurrentTime} >= ${lyricsData[i].time} ? ${safeCurrentTime >= lyricsData[i].time}`);
        if (lyricsData[i].time <= safeCurrentTime) {
            newLyricIndex = i;
            console.log(`  -> åŒ¹é…ï¼Œæš‚å®šç´¢å¼•: ${i}, æ­Œè¯: "${lyricsData[i].text}"`);
        } else {
            // å› ä¸ºå·²æ’åºï¼Œåé¢çš„æ›´å¤§ï¼Œå¯ä»¥æå‰é€€å‡º
            console.log(`  -> å¤§äºå½“å‰æ—¶é—´ï¼Œè·³å‡ºå¾ªç¯`);
            break;
        }
    }

    console.log('æœ€ç»ˆç¡®å®šçš„é«˜äº®è¡Œç´¢å¼•:', newLyricIndex, 'æ­Œè¯å†…å®¹:', lyricsData[newLyricIndex].text);

    if (newLyricIndex !== currentLyricIndex) {
        currentLyricIndex = newLyricIndex;
        displayCurrentLyric();
        console.log('âœ… æ­Œè¯UIå·²æ›´æ–°');
    } else {
        console.log('ğŸ”„ æ­Œè¯ç´¢å¼•æœªå˜ï¼Œæ— éœ€æ›´æ–°UI');
    }
    console.log('--- updateLyrics ç»“æŸ ---\n');
}

function displayCurrentLyric() {
    if (lyricsData.length === 0) {
        lyricsDisplay.innerHTML = '<p class="no-lyrics">æ— æ­Œè¯</p>';
        return;
    }

    // æ„å»ºæ‰€æœ‰æ­Œè¯çš„HTMLï¼Œä¸ºå½“å‰è¡Œæ·»åŠ é«˜äº®ç±»
    const lyricsHTML = lyricsData.map((lyricObj, index) => {
        const isCurrent = index === currentLyricIndex;
        const text = lyricObj.text || '...'; // å¤„ç†ç©ºè¡Œ
        return `<p class="${isCurrent ? 'current-line' : ''}" id="lyric-${index}">${text}</p>`;
    }).join('');

    lyricsDisplay.innerHTML = lyricsHTML;

    // ç¡®ä¿é«˜äº®æ­Œè¯æ»šåŠ¨åˆ°å±å¹•ä¸­å¤®
    const currentLyricElement = document.getElementById(`lyric-${currentLyricIndex}`);
    if (currentLyricElement) {
        currentLyricElement.scrollIntoView({
            behavior: 'smooth',  // å¹³æ»‘æ»šåŠ¨
            block: 'center',     // ä¸­å¤®å¯¹é½
        });
    }
}


        // ===== é”™è¯¯å¤„ç† =====
        function showError(msg) {
            statusMessage.textContent = `é”™è¯¯: ${msg}`;
            statusMessage.style.color = '#ff6b6b';
            console.error('åº”ç”¨é”™è¯¯:', msg);
            // ç¦ç”¨æ§åˆ¶
            [playPauseBtn, prevBtn, nextBtn].forEach(btn => btn.disabled = true);
        }

        // ===== å¯åŠ¨ =====
        window.addEventListener('DOMContentLoaded', init);

        // ===== é”®ç›˜å¿«æ·é”® (å¯é€‰) =====
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return; // é¿å…å¹²æ‰°è¾“å…¥
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlayPause();
                    break;
                case 'ArrowLeft':
                    playPrev();
                    break;
                case 'ArrowRight':
                    playNext();
                    break;
            }
        });
    </script>
</body>
</html>
